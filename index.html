<!DOCTYPE html>
<html>
  <head>
   <meta charset="UTF-8">
    <title>Graphics Project</title>

    <style type="text/css">
      body {
          background-color: white;
          
      }
      canvas{
         
            background-image: url(images/background.png);
        }
    </style>
  </head>
  <body>
    <canvas id="gamecanvas" width="700" height="500"></canvas>
    <script type="text/javascript">
        
        // Gets a handle to the element with id canvasOne.
        var canvas = document.getElementById("gamecanvas");
      
      // Set the canvas up for drawing in 2D.
      var ctx = canvas.getContext("2d");
        
        var redCarDownImage, redCarUpImage, redCarLeftImage, redCarRightImage;
        var blueCarDownImage, blueCarUpImage, blueCarLeftImage, blueCarRightImage;
        var startGame, gameOver, stopAni;
        var laps, blueLaps;
        
        var init = function(){
            
            redCarUpImage = new Image();
            redCarUpImage.src = "images/redcarup.png";
            redCarDownImage = new Image();
            redCarDownImage.src = "images/redcardown.png";
            redCarRightImage = new Image();
            redCarRightImage.src = "images/redcarright.png";
            redCarLeftImage = new Image();
            redCarLeftImage.src = "images/redcarleft.png";
            blueCarUpImage = new Image();
            blueCarUpImage.src = "images/bluecarup.png";
            blueCarDownImage = new Image();
            blueCarDownImage.src = "images/bluecardown.png";
            blueCarLeftImage = new Image();
            blueCarLeftImage.src = "images/bluecarleft.png";
            blueCarRightImage = new Image();
            blueCarRightImage.src = "images/bluecarright.png";
            startGame=false;
            stopAni=false;
            laps=0;
            blueLaps=0;
            
        }
        
        init();
        
        //load car images
        redCarUpImage.onload = function () {
	       redCarUpImage.active=false;
        }
        redCarDownImage.onload = function () {
	       redCarDownImage.active=false;
        }   
        redCarRightImage.onload = function () {
	       redCarRightImage.active=false;
        }
        redCarLeftImage.onload = function () {
	       redCarLeftImage.active=false;
        }
        blueCarUpImage.onload = function () {
	       blueCarUpImage.active=false;
        }
        blueCarDownImage.onload = function () {
	       blueCarDownImage.active=false;
        }   
        blueCarRightImage.onload = function () {
	       blueCarRightImage.active=false;
        }
        blueCarLeftImage.onload = function () {
	       blueCarLeftImage.active=false;
        }
  
        //car obj coordinates
        var redCar = {
            "x": 148,
            "y": 88
        }
        
        var blueCar = {
            "x": 148,
            "y": 48
        }
        
        //draw car image depending on faced direction
        var draw = function(redXPos,redYPos, blueXPos, blueYPos){
            
            //clear the canvas before each draw 
            canvas.width=canvas.width;
            
            //lap count text
            ctx.fillStyle = "rgb(250, 250, 250)";
	        ctx.font = "24px Helvetica";
	        ctx.textAlign = "left";
	        ctx.textBaseline = "top";
	        ctx.fillText("Laps: " + laps, 10, 6);
            
            if(redCarUpImage.active==true){
                ctx.drawImage(redCarUpImage, redXPos, redYPos);
            }
            else if(redCarDownImage.active==true){
                ctx.drawImage(redCarDownImage, redXPos, redYPos);
            }
            else if(redCarLeftImage.active==true){
                ctx.drawImage(redCarLeftImage, redXPos, redYPos);
            }
            else{
                ctx.drawImage(redCarRightImage, redXPos, redYPos);
            }
            
            if(blueCarUpImage.active==true){
                ctx.drawImage(blueCarUpImage, blueXPos, blueYPos);
            }
            else if(blueCarDownImage.active==true){
                ctx.drawImage(blueCarDownImage, blueXPos, blueYPos);
            }
            else if(redCarLeftImage.active==true){
                ctx.drawImage(blueCarLeftImage, blueXPos, blueYPos);
            }
            else{
                ctx.drawImage(blueCarRightImage, blueXPos, blueYPos);
            }
            
        }
        //car movement dependent on location on the track
        var driveRed = function(){
            
            if(startGame==true){
            
                //all allowed down movements
                if((redCarDownImage.active==true)&&(redCar.y<canvas.height-50)){

                    if(((redCar.x<108)||(redCar.x>573))&&(redCar.y<200)){
                        redCar.y+=5;
                    }
                    else if(((redCar.x<223)&&(redCar.x>118))&&((redCar.y<310)&&(redCar.y>168))){
                        redCar.y+=5;
                    }
                    else if(((redCar.x>588)&&(redCar.x<668))&&((redCar.y>280)&&(redCar.y<433))){
                        redCar.y+=5;
                    }

                }
                //all allowed up movements
                else if((redCarUpImage.active==true)&&(redCar.y>40)){

                    if((redCar.x>3)&&(redCar.x<93)){
                        redCar.y-=5;
                    }
                }
                //all allowed right movements
                else if((redCarRightImage.active==true)&&(redCar.x<canvas.width-35)){

                    if((redCar.y>33)&&(redCar.y<95)&&(redCar.x>3)){
                         redCar.x+=5;
                    }

                    else if(((redCar.y>273)&&(redCar.y<343))&&(redCar.x<648)){
                        redCar.x+=5;
                    }
                }

                //all allowed left movements
                else if((redCarLeftImage.active==true)&&(redCar.x>4)){

                    if(((redCar.y>153)&&(redCar.y<218)&&(redCar.x<669)&&(redCar.x>128))){
                         redCar.x-=5;
                    }

                    else if(((redCar.y>393)&&(redCar.y<453))&&((redCar.x<668)&&(redCar.x>23))){
                        redCar.x-=5;
                    }
                }
            }
            
        }//driveRed
        
        var driveBlue = function(){
            
           if(startGame==true){ 
            
                if((blueCar.y>38)&&(blueCar.y<90)&&((blueCar.x>3)&&(blueCar.x<650))){
                    blueCarRightImage.active=true;
                    blueCarDownImage.active=false;
                    blueCarLeftImage.active=false;
                    blueCarUpImage.active=false;
                    blueCar.x+=5;
                }//first right track
               
                if(((blueCar.y>38)&&(blueCar.y<203))&&((blueCar.x<650)&&(blueCar.x>580))){
                    blueCarRightImage.active=false;
                    blueCarDownImage.active=true;
                    blueCarLeftImage.active=false;
                    blueCarUpImage.active=false;
                    blueCar.y+=5;
                    
                }//first down track

                if(((blueCar.y>163)&&(blueCar.y<210))&&((blueCar.x<640)&&(blueCar.x>126))){
                    blueCarRightImage.active=false;
                    blueCarDownImage.active=false;
                    blueCarLeftImage.active=true;
                    blueCarUpImage.active=false;
                    blueCar.x-=5;
                }//first left track
               
                if(((blueCar.y>160)&&(blueCar.y<313))&&((blueCar.x<205)&&(blueCar.x>120))){
                    blueCarRightImage.active=false;
                    blueCarDownImage.active=true;
                    blueCarLeftImage.active=false;
                    blueCarUpImage.active=false;
                    blueCar.y+=5;
                }//second down track
               
               if(((blueCar.y>310)&&(blueCar.y<328))&&((blueCar.x<648)&&(blueCar.x>150))){
                   blueCarRightImage.active=true;
                    blueCarDownImage.active=false;
                    blueCarLeftImage.active=false;
                    blueCarUpImage.active=false; 
                   blueCar.x+=5;
                }//second right track
               
               if(((blueCar.y>312)&&(blueCar.y<433))&&((blueCar.x<648)&&(blueCar.x>600))){
                   blueCarRightImage.active=false;
                    blueCarDownImage.active=true;
                    blueCarLeftImage.active=false;
                    blueCarUpImage.active=false;
                   blueCar.y+=5;
               }//third down track
               
               if(((blueCar.y>428)&&(blueCar.y<435))&&((blueCar.x<648)&&(blueCar.x>23))){
                   blueCarRightImage.active=false;
                    blueCarDownImage.active=false;
                    blueCarLeftImage.active=true;
                    blueCarUpImage.active=false;
                   blueCar.x-=5;
               }//second left track
               
               if(((blueCar.y>38)&&(blueCar.y<434))&&((blueCar.x<75)&&(blueCar.x>8))){
                   blueCarRightImage.active=false;
                    blueCarDownImage.active=false;
                    blueCarLeftImage.active=false;
                    blueCarUpImage.active=true;
                   blueCar.y-=5;
               }//up track
               
           }
        }
        
        //event listener reacts to arrow keypress and changes image of car according to direction
        //and moves
        window.addEventListener("keydown", function(event) { 
            // Just log the event to the console.

              //canvas.width=canvas.width;
              //canvas.height=canvas.height;
            
              if(event.keyCode==32){ //spacebar toggles startGame value between true and false to pause
                startGame^=true;
              }

              if(event.keyCode==40) { //down
                    
                  redCar.y+=5;
                  redCarDownImage.active=true;
                  redCarUpImage.active=false;
                  redCarRightImage.active=false;
                  redCarLeftImage.active=false;
                  
              }
              else if(event.keyCode==38){//up
                  
                  redCar.y-=5;
                  redCarUpImage.active=true;
                  redCarDownImage.active=false;
                  redCarRightImage.active=false;
                  redCarLeftImage.active=false;
                  
              }
              else if(event.keyCode==39){//right

                  redCar.x+=5;
                  redCarRightImage.active=true;
                  redCarUpImage.active=false;
                  redCarDownImage.active=false;
                  redCarLeftImage.active=false;
                  
              }
              else if(event.keyCode==37){//left
                  redCar.x-=5;
                  redCarLeftImage.active=true;
                  redCarRightImage.active=false;
                  redCarUpImage.active=false;
                  redCarDownImage.active=false;
              }
 
        });//event listener
        
        var lapCount = function(){
            
            if(startGame==true){
                if((redCar.x==113)&&((redCar.y>28)&&(redCar.y<105))){
                    laps++;
                }
            } 
            
            if((blueCar.x==113)&&((blueCar.y>28)&&(blueCar.y<105))){
                    blueLaps++;
                }
             
            if(laps==3){
                startGame=false;
                stopAni=true;
                                
                //lap count text
                ctx.fillStyle = "rgb(250, 250, 250)";
                ctx.font = "24px Helvetica";
                ctx.textAlign = "left";
                ctx.textBaseline = "top";
                ctx.fillText("You Win!: ", canvas.width/2, canvas.height/2);
            }
            
            else if(blueLaps==3){
                startGame=false;
                stopAni=true;
                                
                //lap count text
                ctx.fillStyle = "rgb(250, 250, 250)";
                ctx.font = "50px Helvetica";
                ctx.textAlign = "left";
                ctx.textBaseline = "top";
                ctx.fillText("Blue Car Wins !", 200, canvas.height/2);
            }
            
            
        }
        
        
  var step = function(){
        
      draw(redCar.x, redCar.y, blueCar.x, blueCar.y);
      driveRed();
      driveBlue();
      lapCount();
      
      if(stopAni==false){
        window.requestAnimationFrame(step);
      }
  }
  
  
  
  step();

    </script>
  </body>
</html>